<!doctype html>
<html>
  <label for="square">Number to Square:</label><br>
  <input type="text" id="square_id" name="square"><br>
  <button id="action" onclick="myFunction()">Press me!</button>
  <p id="result"></p>
  <script>
    function myFunction() {
      var num_text = document.getElementById("square_id").value;
      var num = parseInt(num_text);
      console.log(num);
      square_fun = Module.cwrap(
          'square_fun', 'number', ['number', 'number']
      );
      //var dataPtr = Module._malloc(4); // Not the best solution
      var data = new Int32Array([num]);
      var nDataBytes = 4;
      var dataPtr = Module._malloc(nDataBytes);

      // Copy data to Emscripten heap (directly accessed from Module.HEAPU8)
      var dataHeap = new Uint8Array(Module.HEAPU8.buffer, dataPtr, nDataBytes);
      dataHeap.set(new Uint8Array(data.buffer));

      // Call function and get result
      square_fun(num, dataHeap.byteOffset);
      var result = new Int32Array(dataHeap.buffer, dataHeap.byteOffset, 1);
      console.log("Printing the result below ...");
      console.log(result[0]);
      document.getElementById("result").innerHTML = result[0];
    }
  </script>
  <script src="square.js"></script>
</html>
